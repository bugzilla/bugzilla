[%# This Source Code Form is subject to the terms of the Mozilla Public
  # License, v. 2.0. If a copy of the MPL was not distributed with this
  # file, You can obtain one at http://mozilla.org/MPL/2.0/.
  #
  # This Source Code Form is "Incompatible With Secondary Licenses", as
  # defined by the Mozilla Public License, v. 2.0.
  #%]

[% IF has_tbpl_comment %]
  [% expand_caption   = 'Expand TinderboxPushlog Comments' %]
  [% collapse_caption = 'Collapse TinderboxPushlog Comments' %]
  <script>
    YAHOO.util.Event.onDOMReady(function () {
        var ul = document.getElementsByClassName('bz_collapse_expand_comments');
        if (ul.length == 0)
            return; 
        var li = document.createElement('li');
        var a = document.createElement('a');
        Dom.setAttribute(a, 'href', 'javascript:void(0)');
        Dom.setAttribute(a, 'id', 'toggle_tbplbot_comments');
        a.innerHTML = '[% expand_caption FILTER js %]';
        YAHOO.util.Event.on(a, 'click', function() {
            var do_expand = a.innerHTML == '[% expand_caption FILTER js %]';
            for (var i = 0, n = tbpl_comment_ids.length; i < n; i++) {
                var id = tbpl_comment_ids[i];
                var link = document.getElementById('comment_link_' + id);
                var text = document.getElementById('comment_text_' + id);
                if (do_expand) {
                    expand_comment(link, text);
                } else {
                    collapse_comment(link, text);
                }
            }
            a.innerHTML = do_expand
              ? '[% collapse_caption FILTER js %]'
              : '[% expand_caption FILTER js %]';
        });
        li.appendChild(a);
        ul[0].appendChild(li);
    });
  </script>
[% END %]
